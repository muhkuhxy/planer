@import models.smt._
@import tags._
@import helper._
@import java.time.LocalDate
@import java.time.DayOfWeek._
@import java.time.format._
@import java.time.temporal._
@import java.util.Locale

@(assignees: List[Assignee], plan: Plan)

<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width,initial-scale=1">
   <title>planer</title>
   <script src='@routes.Assets.at("lib/moment/moment.js")' type="text/javascript"></script>
   <link rel="stylesheet" href='@routes.Assets.at("stylesheets/style.css")'>
</head>
<body id="api" data-url="@controllers.smt.routes.PlanController.showJson(plan.id)">

   @nav()

   <div class="container" id="wrapper">

      <header class="row" v-if="plan">
         <div class="col-xs-12">
           <h2>{{ plan.name }}</h2>
         </div>
      </header>

      <smt-table :plan="plan" :current="current">
      </smt-table>

      <smt-placeholder :assignments="assignments" :date="date">
      </smt-placeholder>

      @timesAssigned(name: String) = {
      @{
         val assigned = for( part <- plan.parts;
                             (_,list) <- part.assignments;
                             assg <- list if assg == name) yield name
         assigned.size
      }}

      <div class="row kandidaten">
         <div class="col-xs-12 flex">
            <h2>Helfer</h2>
            <ul>
            @for(assignee <- assignees) {
               <li>
                  <div draggable="true">
                     <span class="name">@assignee.name</span>
                     <input class="pull-right" name="unavailable" value="" type="checkbox">
                     <div class="dienste">
                        <div class="counter pull-left">@timesAssigned(assignee.name)</div>
                     @for(s <- assignee.services) {
                        <span class="@s">@s(0)</span>
                     }
                     </div>
                  </div>
               </li>
            }
            <ul>
            <div class="blocker">Datum ausw√§hlen</div>
         </div>
      </div>

      <div class="save">
         <button class="btn btn-primary" type="button" @@click="save" :disabled="this.saveState === 'working'">Speichern</button>
         <status-indicator :state="saveState" />
         <a class="btn btn-default" href='mailto:@assignees.map(_.email).flatten.mkString(",")'>E-Mail</a>
      </div>

   </div>
   <script src='https://unpkg.com/vue@@2.5.3/dist/vue.js' type="text/javascript"></script>
   <script src='@routes.Assets.at("main.js")' type="text/javascript"></script>
   <script>app.planer.init()</script>
</body>
</html>
